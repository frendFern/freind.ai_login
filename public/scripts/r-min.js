let pe,ye,ve="https://d2141ekkpgdi0u.cloudfront.net";!function(e,t){(t=e.createElement("script")).setAttribute("disable-devtool-auto",""),t.type="text/javascript",t.onload=function(){},1!=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}).d&&(t.src="https://cdn.jsdelivr.net/npm/disable-devtool",e.getElementsByTagName("head")[0].appendChild(t))}(document),async function(){window.mobileCheck=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);var e=PIXI.live2d;let t=localStorage.getItem("uuid");t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),localStorage.setItem("uuid",t)),userid=t;var n=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});let U=n.v,H=n.a;n.u;let _=n.s;const N=new PIXI.Application({view:document.getElementById("frend-canvas"),autoStart:!0,backgroundAlpha:0,height:600,width:600});ye=N;var o,s,n=await Promise.all([e.Live2DModel.from("models/Santa3/Santa.model3.json")]);n.forEach(e=>{var t,n;N.stage.addChild(e),(t=e).buttonMode=!0,t.on("pointerdown",e=>{t.dragging=!0,t._pointerX=e.data.global.x-t.x,t._pointerY=e.data.global.y-t.y}),t.on("pointermove",e=>{t.dragging&&(t.position.x=e.data.global.x-t._pointerX,t.position.y=e.data.global.y-t._pointerY)}),t.on("pointerupoutside",()=>t.dragging=!1),t.on("pointerup",()=>t.dragging=!1),(n=e).on("click",e=>{console.log(e),n.motion("Tap")})});const d=n[0];let R=setInterval(function(e){var t=document.getElementById("main-body");e.visible?(t.classList.remove("loading"),_&&S(_),window.mobileCheck||(w.classList.add("desktop-temp"),h()),clearInterval(R),R=null):t.classList.add("loading")},500,d);d.height=d.internalModel.originalHeight/2,d.width=d.internalModel.originalWidth/2,pe=d,H&&((o=document.getElementById("frend-share-play")).classList.remove("hidden"),o.onclick=function(){var e,t;url=(e=U,t=H,url="https://frend-audio.s3.amazonaws.com/"+e+"/"+t+".mp3"),s.classList.remove("hidden"),o.classList.add("hidden"),pe.speak(url)},(s=document.getElementById("frend-share-stop")).onclick=function(){s.classList.add("hidden"),o.classList.remove("hidden"),pe.stopSpeaking()}),d.on("hit",e=>{e.includes("Body")&&d.motion("Tap"),e.includes("Head")});e=document.getElementById("frend-settings-btn");const r=document.getElementById("frend-settings-screen");function V(){r.classList.toggle("hidden")}document.getElementById("frend-settings-close").onclick=V,e.onclick=V;const a=document.getElementById("frend-notification-controls-on"),i=document.getElementById("frend-notification-controls-off"),X=document.getElementById("frend-settings-notification"),l=(a.onclick=function(){a.classList.add("set"),i.classList.remove("set"),X.value="on"},i.onclick=function(){i.classList.add("set"),a.classList.remove("set"),X.value="off"},document.getElementById("frend-login"));n=document.getElementById("frend-settings-account-id-link"),e=document.getElementById("frend-login-close");const F=document.getElementById("frend-sign-in"),J=document.getElementById("frend-register");var c=document.getElementById("frend-create-user-btn"),m=document.getElementById("frend-sign-in-btn");const Y=document.getElementById("frend-settings-account-id-link"),z=document.getElementById("frend-settings-account-details"),u=(n.onclick=function(){l.classList.remove("hidden"),r.classList.add("hidden")},e.onclick=function(){l.classList.add("hidden"),r.classList.remove("hidden")},c.addEventListener("click",e=>{e.preventDefault(),F.classList.add("hidden"),J.classList.remove("hidden")}),m.addEventListener("click",e=>{e.preventDefault(),F.classList.remove("hidden"),J.classList.add("hidden")}),document.getElementById("frend-chat-btn")),g=document.getElementById("frend-chat-screen"),h=function(){u.classList.toggle("selected"),g.classList.toggle("hidden")};u.onclick=h;let f=[];const p=document.getElementById("frend-chat-form"),y=document.getElementById("frend-chat-messages"),v=document.getElementById("frend-chat-screen-history-msgs"),q=document.getElementById("frend-loading"),W=document.getElementById("frend-chat-loading");n=document.getElementById("frend-login-form"),e=document.getElementById("frend-create-user-form");function E(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function L(e){return/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/.test(e)}function $(e){localStorage.setItem("token",e)}function Z(e){e=document.querySelector(e);const t={};return e.querySelectorAll("input").forEach(e=>{"submit"===e.type||"button"===e.type||"radio"==e.type&&!e.checked||(t[e.name]=e.value)}),t}const b=document.getElementById("frend-login-error"),I=(n.addEventListener("submit",function(e){e.preventDefault(),(userObj=Z("#frend-login-form")).email&&userObj.password&&E(userObj.email)&&L(userObj.password)?(document.getElementById("frend-user-email-error").classList.add("hidden"),document.getElementById("frend-user-password-error").classList.add("hidden"),userObj.agent_id="shiba",body={user:userObj,method:"login"},fetch(ve+"/frend-user-crud",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)}).then(e=>{if(b.classList.add("hidden"),e.ok)return e.json();throw e.text().then(function(e){b.innerHTML=e,b.classList.remove("hidden")}),new Error("Error fetching data from the API")}).then(e=>{$(e),k(4)}).catch(e=>{e?console.error(e):console.error("Ran into error making API call...")})):(userObj.email&&E(userObj.email)?document.getElementById("frend-user-email-error").classList.add("hidden"):document.getElementById("frend-user-email-error").classList.remove("hidden"),userObj.password&&L(userObj.password)?document.getElementById("frend-user-password-error").classList.add("hidden"):document.getElementById("frend-user-password-error").classList.remove("hidden"))}),document.getElementById("frend-create-login-error"));e.addEventListener("submit",function(e){e.preventDefault(),(userObj=Z("#frend-create-user-form")).email&&userObj.password&&E(userObj.email)&&L(userObj.password)?(document.getElementById("frend-create-user-email-error").classList.add("hidden"),document.getElementById("frend-create-user-password-error").classList.add("hidden"),userObj.agent_id="shiba",userObj.language=document.getElementById("frend-language-select").value,body={user:userObj,method:"create"},fetch(ve+"/frend-user-crud",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(body)}).then(e=>{if(I.classList.add("hidden"),e.ok)return e.json();throw e.text().then(function(e){I.innerHTML=e,I.classList.remove("hidden")}),new Error("Error fetching data from the API")}).then(e=>{$(e),k(4)}).catch(e=>{e?console.error(e):console.error("Ran into error making API call...")})):(userObj.email&&E(userObj.email)?document.getElementById("frend-create-user-email-error").classList.add("hidden"):document.getElementById("frend-create-user-email-error").classList.remove("hidden"),userObj.password&&L(userObj.password)?document.getElementById("frend-create-user-password-error").classList.add("hidden"):document.getElementById("frend-create-user-password-error").classList.remove("hidden"))});c=document.getElementById("frend-voice-select"),c.onchange=function(e){localStorage.setItem("voice",e.target.value)},m=localStorage.getItem("voice");c.value="Default"!=m?localStorage.getItem("voice"):"Default";const w=document.getElementById("frend-floater"),B=document.getElementById("frend-widget-controls");n=document.getElementById("frend-settings-screen"),e=document.getElementById("frend-settings-btn"),c=document.getElementById("frend-move-control");const x=document.getElementById("frend-chat-screen-input-area");var m=document.getElementById("frend-chat-screen-history"),G=document.getElementById("frend-chat-screen-history-msgs"),K=document.getElementById("frend-canvas"),Q=document.getElementById("frend-ppt-btn");function k(e){0==e?(p.classList.add("hidden"),x.classList.add("hidden"),q.classList.remove("hidden"),W.classList.remove("hidden")):1==e?(p.classList.remove("hidden"),x.classList.remove("hidden"),q.classList.add("hidden"),W.classList.add("hidden")):2==e?(w.classList.add("show"),B.classList.add("show"),D.classList.add("frend-press")):3==e?(w.classList.remove("show"),B.classList.remove("show"),D.classList.remove("frend-press")):4==e&&(l.classList.add("hidden"),Y.classList.add("hidden"),z.classList.remove("hidden"))}window.mobileCheck?(w.classList.add("mobile"),n.classList.add("mobile"),K.classList.add("mobile"),B.classList.add("mobile"),e.classList.add("mobile"),c.classList.add("hidden"),u.classList.add("hidden"),g.classList.add("mobile"),g.classList.remove("hidden"),x.classList.add("mobile"),m.classList.add("mobile"),G.classList.add("mobile"),Q.classList.add("mobile")):(g.classList.remove("hidden"),c.classList.add("hidden"),h());const C=document.getElementById("frend-chat-screen-input-type"),ee=document.getElementById("frend-chat-screen-hitsory-ai-template"),te=document.getElementById("frend-chat-screen-hitsory-user-template");C.addEventListener("keyup",function(e){"Enter"===e.key&&oe.click()});let S=function(e){var t,n,o,s,d,r=document.createElement("p"),a=document.createElement("div"),i=document.createElement("button"),l=document.createElement("button"),c=document.createElement("button"),m=(a.classList.add("frend-control-center"),i.classList.add("pure-button","smaller-button"),l.classList.add("pure-button","smaller-button"),c.classList.add("pure-button","smaller-button"),ee.firstElementChild.cloneNode(!0)),u=(m.firstElementChild.innerText="Santa",m.lastElementChild.innerText=e,v.appendChild(m),v.scrollTop=v.scrollHeight,u=e,t=i,n=a,o=y,s=m,d=v,m=localStorage.getItem("voice"),selectedVoice="4","deep"==m?selectedVoice="3":"kid"==m?selectedVoice="2":"Santa"==m&&(selectedVoice="4"),m={text:u,voice:selectedVoice},fetch(ve+"/frend-audio",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(e=>e.json()).then(e=>{e=JSON.parse(e.body);url=e.audio,t.setAttribute("data-url",url),file_name=url.split("/").pop().split(".")[0],share_url=window.location.origin+"?v="+selectedVoice+"&a="+file_name,n.setAttribute("data-share-url",share_url),o.appendChild(n),o.scrollTop=o.scrollHeight,s.appendChild(n),d.scrollTop=d.scrollHeight,pe.speak(url)}).catch(e=>console.error("Error:",e)).finally(()=>{pe.internalModel.motionManager.expressionManager.currentExpression.release()}),"Shiba: "+e);r.textContent=u,f.push(u),y.appendChild(r),i.innerHTML='<i class="icono-sync"></i>',i.onclick=function(){var e=this.getAttribute("data-url");pe.speak(e)},l.innerHTML='<i class="icono-stop"></i>',l.onclick=function(){pe.stopSpeaking()},c.innerHTML='<i class="icono-share"></i>';c.onclick=async function(){var e=this.parentElement.getAttribute("data-share-url");try{await navigator.clipboard.writeText(e);const t=document.getElementById("frend-toast");t.textContent="Copied to clipboard",t.classList.add("show"),setTimeout(()=>{t.classList.remove("show")},3e3)}catch(e){console.error("Failed to copy text: ",e)}},a.appendChild(i),a.appendChild(l),a.appendChild(c),y.scrollTop=y.scrollHeight};function ne(t){t.preventDefault();let e=localStorage.getItem("mc");var n,o;token=localStorage.getItem("token"),e?e++:e=1,10<e&&token,k(0),o=pe,n?o.expression(n):o.expression();let s;try{s=t.target.elements.message.value}catch{s=C.value}0==s.length?(S("Seems we have an issue with the mic, try getting closer or speaking louder."),k(1)):(n=document.createElement("p"),userMessage="User: "+s,n.textContent=userMessage,f.push(userMessage),y.appendChild(n),y.scrollTop=y.scrollHeight,(o=te.firstElementChild.cloneNode(!0)).firstElementChild.innerText="User",o.lastElementChild.innerText=s,v.appendChild(o),v.scrollTop=v.scrollHeight,promptContext=s,fetch(ve+"/frend-llm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:promptContext,chatHistory:f.join("\n"),userid:userid,frendCard:"santa.json"})}).then(e=>e.json()).then(e=>{e.text?e.text=e.text.replace("Shiba:",""):e.text="Seems like my language model is having some issues.  Sorry about this, please try talking to me again in a few hours.  Or reach out to hi@frend.ai and let us know something is wrong.",S(e.text);try{t.target.elements.message.value=""}catch{C.value=""}}).catch(e=>console.error("Error:",e)).finally(()=>{k(1)}))}const oe=document.getElementById("frend-chat-screen-input-submit");function se(e,t){var n=e.numberOfChannels,o=e.sampleRate,t=(t=t||{}).float32?3:1,s=3==t?32:16,e=2===n?function(e,t){var n=e.length+t.length,o=new Float32Array(n),s=0,d=0;for(;s<n;)o[s++]=e[d],o[s++]=t[d],d++;return o}(e.getChannelData(0),e.getChannelData(1)):e.getChannelData(0),d=s/8,r=n*d,a=new ArrayBuffer(44+e.length*d),i=new DataView(a);return T(i,0,"RIFF"),i.setUint32(4,36+e.length*d,!0),T(i,8,"WAVE"),T(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,t,!0),i.setUint16(22,n,!0),i.setUint32(24,o,!0),i.setUint32(28,o*r,!0),i.setUint16(32,r,!0),i.setUint16(34,s,!0),T(i,36,"data"),i.setUint32(40,e.length*d,!0),(1===t?function(e,t,n){for(var o=0;o<n.length;o++,t+=2){var s=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,s<0?32768*s:32767*s,!0)}}:function(e,t,n){for(var o=0;o<n.length;o++,t+=4)e.setFloat32(t,n[o],!0)})(i,44,e),a}function T(e,t,n){for(var o=0;o<n.length;o++)e.setUint8(t+o,n.charCodeAt(o))}oe.onclick=ne,p.addEventListener("submit",ne);var de=new(window.AudioContext||window.webkitAudioContext);let j,re,O=!1;function ae(){let n=[];O||(k(0),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{re=e,(j=new MediaRecorder(e)).ondataavailable=e=>{0<e.data.size&&n.push(e.data)},j.onstop=()=>{var e=new Blob(n,{type:"audio/webm; codecs=opus"}),t=new FileReader;t.onload=function(e){e.target.result},t.readAsArrayBuffer(e),t.onloadend=function(e){de.decodeAudioData(t.result,function(e){var n=se(e);setTimeout(()=>{var e,t;e=n,t=ve+"/frend-stt",fetch(t,{method:"POST",headers:{"Content-Type":"audio/wav"},body:e}).then(e=>e.json().then(e=>{message=e.body.DisplayText,C.value=message,oe.click()})).catch(e=>{console.error("Error sending audio to API:",e)})},1e3)},function(e){console.log(e)})}},j.start(),O=!0}).catch(e=>{console.error("Error accessing microphone:",e)}))}function ie(){O&&(j.stop(),re.getTracks().forEach(e=>e.stop()),O=!1)}document.getElementById("image");var A,le,ce,M,P,me=!1,ue=null;document.addEventListener("keydown",function(e){" "!==e.key||me||"frend-chat-screen-input-type"===document.activeElement.id||(me=!0,Date.now(),ue=setTimeout(function(){k(2),ae()},500))}),document.addEventListener("keyup",function(e){" "===e.key&&"frend-chat-screen-input-type"!==document.activeElement.id&&(clearTimeout(ue),me=!1,k(3),ie())});const D=document.getElementById("frend-ppt-btn");if(window.mobileCheck){let e=!1;D.onclick=function(){e=e?(k(3),ie(),!1):(k(2),ae(),!0)}}else D.addEventListener("mousedown",function(){k(2),ae()}),D.addEventListener("mouseup",function(){k(3),ie()});function ge(e){w.classList.remove("desktop-temp"),(e=e||window.event).preventDefault(),M=e.clientX,P=e.clientY,document.onmouseup=fe,document.onmousemove=he}function he(e){(e=e||window.event).preventDefault(),le=M-e.clientX,ce=P-e.clientY,M=e.clientX,P=e.clientY,A.style.top=A.offsetTop-ce+"px",A.style.left=A.offsetLeft-le+"px"}function fe(){document.onmouseup=null,document.onmousemove=null}A=document.getElementById("frend-floater"),P=M=ce=le=0,document.getElementById("frend-move-control")?document.getElementById("frend-move-control").onmousedown=ge:A.onmousedown=ge}();